# 项目介绍

Kiva系统通过多AGV协同实现实现货到人的自动分拣，系统的核心是动态的多智能体路径规划（MAPF）问题。该项目利用cbs算法对Kiva式自动分拣系统进行仿真。

项目默认的地图是22*48的栅格地图，如下所示

![30 orders, 47 AGVs](C:\Users\62687\Desktop\大四\课程设计\代码\Kiva分拣系统仿真-ver1.5\gifs\30 orders, 47 AGVs.gif)

AGV只能沿水平或垂直方向移动，速度恒定为1栅格/时间步，不考虑启动与制动时间，转向90°需2时间步，转向180°需3时间步（可自定义）。

订单包含若干个目标货架的位置、一个工作台的位置，分配逻辑为将目标货架就近分配给附近空闲AGV。

订单完成流程如下：

1. 订单下达
2. AGV从起点出发至指定货架
3. 抬起货架
4. 将货架运送至目标工作台
5. 等待工人拣选
6. 将货架送还至原位置
7. 放下货架
8. 执行下一个订单

##### AGV状态转换流程图

![AGV状态流程图](C:\Users\62687\Desktop\大四\课程设计\代码\Kiva分拣系统仿真-ver1.5\AGV状态流程图.png)

如图所示，仿真开始时所有AGV都是available状态，就近分配订单后进入to shelf状态（前往货架）。抵达货架位置并将其抬起后会检测目标工作台是否被占用或者预订，若被占用则进入waiting to select状态（等待前往分拣），若未被占用则进入to select状态（前往分拣）。抵达工作台后进入selecting状态（分拣中），分拣结束后进入return shelf状态（归还货架）。抵达货架位置后会检测电量是否充足，若低于阈值则检测当前是否有可用的充电桩，没有则进入waiting to charge状态（等待充电），有可用充电桩则进入to charge状态（前往充电）。抵达充电桩位置后进入charging状态（充电中）。若电量充足则重新进入available状态，继续检测是否有新订单，若无新订单则会检测AGV是否已经处于起点位置，若没有位于起点位置则进入back to start状态（返回起点）。到达起点后会检测该AGV是否是最后一个到达起点的AGV，若否则进入arrived at start状态（进入该状态会使当前所有运动状态的AGV重新规划路径，避免其通过该起点），若是直接进入waiting at start状态。当所有AGV进入waiting at start状态，仿真结束。此外，完成上一单未充电的AGV接到新订单后，会检测新订单的目标货架是否与上一单相同，若是则检测目标工作台是否可用，进入waiting to select或to select状态。

# 环境依赖

##### 运行系统

windows11 python 3.10.9 (Pycharm IDE)

##### 依赖包

pandas 1.5.3
numpy  1.23.5
matplotlib 3.7.0

# 目录结构描述

├── ReadMe.md                      // 说明文档

├── a_star.py                           // 带约束的时空A*算法

├── agv.py                               // AGV对象

├── cbs.py                               // cbs算法

├── mapAndOrder.py           // 地图和订单生成与分配

├── visualization.py              // 可视化

├── simulation.py                 // 仿真函数

└── run experiment.py        // 运行实验

# 使用说明

在run experiment.py中运行即可。

由于不同显示器分辨率不同，生成的可视化界面的文字可能会大小失常，但保存的动图界面一定是正常的。

##### 自定义地图

![自定义地图示例](C:\Users\62687\Desktop\大四\课程设计\代码\Kiva分拣系统仿真-ver1.3\自定义地图示例.png)

如图所示，-1表示地图边界（目前只支持矩形地图，地图尺寸任意），1表示货架，2表示工作台，3表示充电桩，三者的数量和位置可以自定义，注意事项如下：

1. 货架和充电桩不可以放在第一行，因为第一行默认为AGV入口（起点）
2. 工作台只能放在最下面一行
3. 边界必须在excel中贴齐第一行第一列，否则读取可能会出问题

##### AGV参数

1. 自定义AGV转弯的是时长可通过修改a_star.py中的变量TIME_OF_TURN90, TIME_OF_TURN180实现，默认是转90°需要2秒，180°需要3秒
2. AGV的满电量为agv.py中的FULL_CHARGE，默认为3600（因为M200充电十分钟可工作1小时，将3600作为满电量代表可消耗约3600秒（时间步））
3. 电量消耗速度为agv.py中的BATTERY_CONSUMING_SPEED，默认为1（每时间步）
4. 充电速度为agv.py中的CHARGING_SPEED，默认为电量消耗速度的6倍（因为M200充电十分钟可工作1小时，充电速度为耗电速度的6倍）

#  作者

郑楚阳 清华大学工业工程系学生 邮箱：zhengcy18@mails.tsinghua.edu.cn



 